<!DOCTYPE html>
<!-- Додано :lang -->
<html lang="uk" x-data :lang="$store.i18n.selectedLang">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title використовує i18n -->
    <title x-text="`${$store.i18n.t('general.profile')} — ${$store.i18n.t('general.copyright')}`"></title>

    <!-- Мета-теги (базові) -->
    <meta name="description" content="Сторінка профілю користувача на сайті Таємний Світ.">
    <meta name="robots" content="noindex, nofollow"> <!-- Не індексувати сторінки профілів -->

    <!-- Шрифти -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

    <!-- Internationalization -->
    <script type="module" src="js/i18n.js" defer></script>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- API Config & Utils -->
    <script src="js/api-config.js" defer></script>
    <script src="js/api-utils.js" defer></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/profile_styles.css"> <!-- Специфічні стилі профілю -->

    <style>
        /* Стилі для модальних вікон та сповіщень (як у premium.html) */
        /* ... (скопіювати стилі .modal-overlay, .modal-content, .notification з premium.html) ... */
        /* Стилі для завантаження/помилок/порожнього стану (як у authors.html) */
        .loading-indicator { text-align: center; padding: 2rem; color: var(--secondary-text); }
        .error-message { /* Стиль вже є в profile_styles.css, але можна уточнити */
            background-color: rgba(255, 50, 50, 0.1); border: 1px solid rgba(255, 50, 50, 0.3);
            border-radius: var(--border-radius); padding: 1rem; margin: 1.5rem 0;
            color: #ff6b6b; font-size: 0.9rem; display: flex; align-items: center;
        }
        .error-message i { margin-right: 8px; }
        .error-message button { margin-left: auto; padding: 0.3rem 0.8rem; font-size: 0.8rem; }
        .empty-tab-message { /* Стиль вже є в profile_styles.css */
            text-align: center; padding: 3rem 1rem; color: var(--secondary-text);
            background-color: rgba(255, 255, 255, 0.02); border-radius: var(--border-radius);
            border: 1px dashed rgba(255, 255, 255, 0.1); margin-top: 1rem;
        }
        /* Стиль кнопки під час обробки */
        button:disabled { opacity: 0.7; cursor: not-allowed; }
        button.processing { opacity: 0.9; pointer-events: none; position: relative; }
        button.processing::before {
            content: ''; display: inline-block; width: 1em; height: 1em;
            border: 2px solid currentColor; border-left-color: transparent; border-radius: 50%;
            animation: spin 0.7s linear infinite; margin-right: 0.5rem; vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* Додаткові стилі для модалок */
        .modal-overlay { /* Для модалок */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(15, 10, 12, 0.85); display: flex;
            align-items: center; justify-content: center; z-index: 1000;
            padding: 1rem; backdrop-filter: blur(5px);
            opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        .modal-content {
            background-color: var(--card-color); border-radius: var(--border-radius);
            padding: 2rem; max-width: 550px; width: 100%;
            border: 1px solid rgba(153, 0, 0, 0.2); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative; transform: scale(0.95); transition: transform 0.3s ease-out;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .modal-title { font-size: 1.8rem; margin: 0; }
        .modal-close-btn { background: none; border: none; font-size: 1.5rem; color: var(--secondary-text); cursor: pointer; padding: 0.5rem; line-height: 1; transition: color 0.3s; }
        .modal-close-btn:hover { color: var(--text-color); }
        .modal-body { margin-bottom: 2rem; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; flex-wrap: wrap;}
        /* Сповіщення */
        .notification {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%);
            background-color: var(--card-color); color: var(--text-color); padding: 1rem 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); z-index: 1050; min-width: 250px; max-width: 90%; text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1); border-left-width: 4px; opacity: 0;
            transition: opacity 0.3s ease-out, transform 0.4s ease-out; pointer-events: none;
        }
        .notification.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
        .notification.success { border-left-color: #4cd964; }
        .notification.error { border-left-color: #ff6b6b; }
    </style>
</head>
<body x-data="{
    // --- ТЕСТОВИЙ РЕЖИМ ---
    isTesting: true, // Встановіть false для звичайної роботи
    mockUser: {
        _id: 'test-user-123',
        name: 'Тестовий Користувач',
        email: 'test@erostory.world',
        bio: 'Це біографія тестового користувача. Люблю читати та писати захоплюючі історії. Приєднуйтесь до мого світу фантазій!',
        avatarUrl: 'https://source.unsplash.com/random/200x200/?profile,user',
        joinedDate: '2024-01-15T10:00:00Z',
        stats: { storiesWritten: 5, commentsMade: 23, followersCount: 15 },
        isPremium: true // Зробимо його преміум для тесту
    },
    mockSubscription: { // Додамо мок дані для підписки
        planName: 'Premium Yearly',
        status: 'active',
        endDate: new Date(Date.now() + 300 * 24 * 60 * 60 * 1000).toISOString(), // Через ~300 днів
        paymentMethodLast4: '4242'
    },
    // --- Кінець ТЕСТОВОГО РЕЖИМУ ---

    // --- Стани UI ---
    isLoggedIn: false, // Буде встановлено в initializeProfile
    isPremiumUser: false, // Буде встановлено в initializeProfile
    isLoadingProfile: true,
    profileError: null,
    activeTab: 'saved', // 'saved', 'history', 'likes', 'comments', 'following'
    isLoadingActivity: false, // Завантаження даних для активної вкладки
    activityError: null,
    showEditModal: false,
    showPasswordModal: false,
    showSubscriptionModal: false,
    notificationVisible: false,
    notificationMessage: '',
    notificationType: 'success', // 'success' or 'error'
    notificationTimeout: null,
    isProcessingAction: false, // Загальний індикатор для дій (зміна пароля, оновлення профілю)
    isCancellingSubscription: false,

    // --- Дані користувача ---
    user: null, // Буде заповнено
    userId: null, // Буде заповнено

    // --- Дані активності ---
    savedStories: [],
    readingHistory: [], // { story: { _id, title, category, author }, lastReadAt } - Поки заглушка
    likedStories: [],   // { story: { _id, title, category, author }, likedAt } - Поки заглушка
    myComments: [],     // { _id, text, story: { _id, title }, createdAt } - Поки заглушка
    following: [],      // { _id, name, avatarUrl }

    // --- Дані для форм ---
    editName: '',
    editBio: '',
    editAvatarFile: null,
    editAvatarPreview: null,
    currentPassword: '',
    newPassword: '',
    confirmNewPassword: '',
    editFormError: null,
    passwordFormError: null,

    // --- Дані підписки ---
    userSubscription: null, // Буде заповнено

    // --- Пагінація для активності (приклад для Збережених) ---
    savedCurrentPage: 1,
    savedTotalPages: 1,

    // --- Сповіщення ---
    showNotification(message, isSuccess = true) {
        this.notificationMessage = message;
        this.notificationType = isSuccess ? 'success' : 'error';
        const notificationElement = document.getElementById('global-notification'); // Використовуємо ID
        if (notificationElement) {
             notificationElement.classList.remove('success', 'error'); // Спочатку видаляємо обидва класи
             notificationElement.classList.add(isSuccess ? 'success' : 'error'); // Додаємо потрібний
             notificationElement.classList.add('show'); // Показуємо
        }
        this.notificationVisible = true; // Ставимо прапорець
        if (this.notificationTimeout) clearTimeout(this.notificationTimeout);
        this.notificationTimeout = setTimeout(() => {
            this.notificationVisible = false; // Ховаємо прапорець
             const el = document.getElementById('global-notification'); // Знову шукаємо по ID
             if (el) el.classList.remove('show'); // Прибираємо клас show
        }, 4000);
    },

    // --- Завантаження даних ---
    async loadProfileData() {
        // Ця функція викликається ТІЛЬКИ якщо isTesting: false
        this.isLoadingProfile = true;
        this.profileError = null;
        try {
            this.user = await api.users.getCurrentUser();
            if (!this.user) throw new Error($store.i18n?.t('profile.errorLoadingProfile') || 'Не вдалося завантажити профіль');
            this.userId = this.user._id;
            this.isPremiumUser = this.user.isPremium || false;
            // Заповнюємо поля для редагування
            this.editName = this.user.name || '';
            this.editBio = this.user.bio || '';
            this.editAvatarPreview = this.user.avatarUrl || null;
            // Завантажуємо дані для першої вкладки
            await this.loadActivityData(this.activeTab); // Чекаємо завантаження активності
            // Завантажуємо дані підписки, якщо користувач преміум
            if (this.isPremiumUser) await this.loadSubscriptionData(); // Чекаємо завантаження підписки
        } catch (error) {
            this.profileError = error.message;
            console.error('Profile load error:', error);
            // Не робимо редірект тут, бо він вже в initializeProfile
        } finally {
            this.isLoadingProfile = false;
        }
    },
    async loadActivityData(tab) {
        if (this.isLoadingActivity) return;
        this.isLoadingActivity = true;
        this.activityError = null;
        // Очищуємо попередні дані
        const tabKey = tab + 'Stories'; // Ключ для історій
        if (this.hasOwnProperty(tabKey)) this[tabKey] = [];
        if (tab === 'following') this.following = [];
        if (tab === 'comments') this.myComments = [];
        if (tab === 'history') this.readingHistory = [];
        if (tab === 'likes') this.likedStories = [];

        try {
            if (this.isTesting) {
                console.warn(`TEST MODE ACTIVE: Loading mock data for tab: ${tab}`);
                await new Promise(resolve => setTimeout(resolve, 300)); // Симуляція затримки
                // Завантажуємо мок дані для кожної вкладки
                if (tab === 'saved') {
                    this.savedStories = [
                        { story: { _id: 'saved1', title: 'Збережена Історія 1 (Тест)', category: { name: 'Романтика' }, author: { name: 'Автор 1' } }, savedAt: '2024-03-10T12:00:00Z' },
                        { story: { _id: 'saved2', title: 'Збережена Історія 2 (Тест)', category: { name: 'Фантазії' }, author: { name: 'Інший Автор' } }, savedAt: '2024-03-09T18:30:00Z' }
                    ];
                    this.savedTotalPages = 1;
                } else if (tab === 'history') {
                     this.readingHistory = [{ story: { _id: 'hist1', title: 'Прочитана Історія 1 (Тест)', category: { name: 'БДСМ' }, author: { name: 'Автор 3' } }, lastReadAt: '2024-03-11T09:15:00Z' }];
                } else if (tab === 'likes') {
                     this.likedStories = [{ story: { _id: 'liked1', title: 'Вподобана Історія 1 (Тест)', category: { name: 'Перший досвід' }, author: { name: 'Автор 4' } }, likedAt: '2024-03-08T21:00:00Z' }];
                } else if (tab === 'comments') {
                     this.myComments = [{ _id: 'comm1', text: 'Тестовий коментар! Все працює.', story: { _id: 'storyX', title: 'Назва Тестової Історії X' }, createdAt: '2024-03-07T15:45:00Z' }];
                } else if (tab === 'following') {
                     this.following = [
                         { _id: 'authorFollow1', name: 'Тестовий Автор 1', avatarUrl: 'https://source.unsplash.com/random/100x100/?author,1' },
                         { _id: 'authorFollow2', name: 'Тестовий Автор 2', avatarUrl: 'https://source.unsplash.com/random/100x100/?author,2' }
                     ];
                }
            } else {
                // --- Реальні виклики API ---
                console.log(`Loading real data for tab: ${tab}`);
                let response;
                const params = { page: 1, limit: 10 }; // Приклад пагінації (потрібно брати правильну сторінку для кожної вкладки)
                // TODO: Додати окремі змінні currentPage/totalPages для кожної вкладки, якщо потрібна пагінація
                // Наприклад, this.savedCurrentPage, this.savedTotalPages

                switch(tab) {
                    case 'saved':
                        params.page = this.savedCurrentPage;
                        response = await api.users.getBookmarks(params);
                        this.savedStories = response.data || [];
                        this.savedTotalPages = response.totalPages || 1;
                        break;
                    case 'history':
                        // response = await api.users.getReadingHistory(params);
                        // this.readingHistory = response.data || [];
                        console.warn('API call for reading history not implemented yet.');
                        break;
                    case 'likes':
                        // response = await api.users.getLikedStories(params);
                        // this.likedStories = response.data || [];
                         console.warn('API call for liked stories not implemented yet.');
                        break;
                    case 'comments':
                        // response = await api.users.getMyComments(params);
                        // this.myComments = response.data || [];
                         console.warn('API call for my comments not implemented yet.');
                        break;
                    case 'following':
                        response = await api.users.getFollowing(params);
                        this.following = response.data || [];
                        // Пагінація для following?
                        break;
                     default:
                        console.warn(`No API call defined for tab: ${tab}`);
                }
            }
        } catch (error) {
             const defaultErrorMsg = 'Помилка завантаження даних';
             this.activityError = `${$store.i18n?.t('profile.errorLoadingActivityTab', { tab: tab }) || defaultErrorMsg}: ${error.message || $store.i18n?.t('general.unknownError') || ''}`;
             console.error(`Error loading data for tab ${tab}:`, error);
        } finally {
            this.isLoadingActivity = false;
        }
    },
    async loadSubscriptionData() {
         if (this.isTesting) {
             console.warn('TEST MODE ACTIVE: Using mock subscription data.');
             this.userSubscription = this.mockSubscription;
             return;
         }
         // Логіка для реального завантаження
         try {
             this.userSubscription = await api.premium.getCurrentSubscription();
         } catch (error) {
              console.warn('Could not load subscription data:', error);
              this.userSubscription = null;
         }
     },

    // --- Зміна вкладки ---
    changeTab(tab) {
        if (this.activeTab === tab || this.isLoadingActivity) return; // Не перемикати, якщо вже активна або йде завантаження
        this.activeTab = tab;
        this.activityError = null; // Скидаємо помилку
        this.loadActivityData(tab); // Завантажуємо дані
    },

    // --- Дії з активністю ---
    async removeFromSaved(storyId) {
        if (!storyId) return;
        // Використовуємо i18n для підтвердження
        const confirmMessage = $store.i18n?.t('profile.removeFromSavedConfirm') || 'Видалити цю історію зі збережених?';
        if (!confirm(confirmMessage)) return;

        // Оптимістичне видалення
        const originalStories = [...this.savedStories];
        this.savedStories = this.savedStories.filter(item => item.story._id !== storyId);

        try {
            if (!this.isTesting) {
                await api.users.toggleBookmark(storyId); // Викликаємо toggle
            } else {
                await new Promise(resolve => setTimeout(resolve, 300)); // Симуляція
                console.warn(`TEST MODE: Simulated removal of bookmark for story ${storyId}`);
            }
            this.showNotification($store.i18n?.t('profile.storyRemovedFromSaved') || 'Історію видалено.', true);
        } catch (error) {
            this.savedStories = originalStories; // Відкат
            this.showNotification(($store.i18n?.t('profile.errorRemovingSaved') || 'Помилка видалення') + ': ' + error.message, false);
            console.error('Error removing saved story:', error);
        }
    },
    async unfollowAuthor(authorId) {
        if (!authorId) return;
        // Використовуємо i18n для підтвердження
        const confirmMessage = $store.i18n?.t('profile.unfollowAuthorConfirm') || 'Відписатися від цього автора?';
        if (!confirm(confirmMessage)) return;

        // Оптимістичне видалення
        const originalFollowing = [...this.following];
        this.following = this.following.filter(author => author._id !== authorId);

        try {
             if (!this.isTesting) {
                await api.users.toggleFollow(authorId);
             } else {
                await new Promise(resolve => setTimeout(resolve, 300)); // Симуляція
                console.warn(`TEST MODE: Simulated unfollow for author ${authorId}`);
             }
            this.showNotification($store.i18n?.t('profile.unfollowedAuthor') || 'Ви відписалися.', true);
        } catch (error) {
            this.following = originalFollowing; // Відкат
            this.showNotification(($store.i18n?.t('profile.errorUnfollowing') || 'Помилка відписки') + ': ' + error.message, false);
            console.error('Error unfollowing author:', error);
        }
    },

    // --- Редагування профілю ---
    openEditModal() {
        this.editName = this.user?.name || '';
        this.editBio = this.user?.bio || '';
        this.editAvatarPreview = this.user?.avatarUrl || null;
        this.editAvatarFile = null;
        this.editFormError = null;
        this.showEditModal = true;
        console.log('Edit modal opened'); // Лог для перевірки
    },
    handleAvatarChange(event) {
        const file = event.target.files[0];
        if (!file) {
            this.editAvatarFile = null;
            this.editAvatarPreview = this.user?.avatarUrl || null; // Повертаємо старий аватар
            return;
        }
        // Валідація (розмір, тип)
        const maxSize = 2 * 1024 * 1024; // 2MB
        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        if (file.size > maxSize) {
            this.editFormError = $store.i18n?.t('profile.errorAvatarSize', { size: '2MB' }) || 'Файл завеликий (макс 2MB)';
            event.target.value = null; // Скидаємо input
            return;
        }
        if (!allowedTypes.includes(file.type)) {
            this.editFormError = $store.i18n?.t('profile.errorAvatarType') || 'Неприпустимий тип файлу.';
            event.target.value = null; // Скидаємо input
            return;
        }
        this.editFormError = null;
        this.editAvatarFile = file;
        // Створення прев'ю
        const reader = new FileReader();
        reader.onload = (e) => { this.editAvatarPreview = e.target.result; };
        reader.readAsDataURL(file);
    },
    async submitEditProfile() {
        this.editFormError = null;
        if (!this.editName.trim()) {
            this.editFormError = $store.i18n?.t('profile.errorNameRequired') || 'Ім\'я не може бути порожнім.';
            return;
        }
        this.isProcessingAction = true;
        try {
            const updateData = {
                name: this.editName.trim(),
                bio: this.editBio.trim()
            };
            let updatedUser;

            if (!this.isTesting) {
                // Реальні виклики API
                if (this.editAvatarFile) {
                    const formData = new FormData();
                    formData.append('name', updateData.name);
                    formData.append('bio', updateData.bio);
                    formData.append('avatar', this.editAvatarFile);
                    // updatedUser = await api.users.updateUserWithAvatar(formData);
                    console.log('API Call: updateUserWithAvatar');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    updatedUser = { ...this.user, ...updateData, avatarUrl: this.editAvatarPreview }; // Симуляція відповіді
                } else {
                    updateData.avatarUrl = this.editAvatarPreview;
                    // updatedUser = await api.users.updateUser(updateData);
                    console.log('API Call: updateUser (JSON)');
                    await new Promise(resolve => setTimeout(resolve, 800));
                    updatedUser = { ...this.user, ...updateData }; // Симуляція відповіді
                }
            } else {
                // Симуляція в тестовому режимі
                console.warn('TEST MODE: Simulating profile update.');
                await new Promise(resolve => setTimeout(resolve, 500));
                updatedUser = { ...this.user, ...updateData, avatarUrl: this.editAvatarPreview || this.user.avatarUrl };
            }

            // Оновлюємо локальні дані користувача
            if (this.user) { // Додано перевірку
                 this.user.name = updatedUser.name;
                 this.user.bio = updatedUser.bio;
                 this.user.avatarUrl = updatedUser.avatarUrl;
            }

            this.showEditModal = false;
            this.showNotification($store.i18n?.t('notifications.profileUpdated') || 'Профіль оновлено!', true);
        } catch (error) {
            this.editFormError = error.message || $store.i18n?.t('profile.errorSavingProfile') || 'Помилка збереження профілю.';
            console.error('Profile update error:', error);
        } finally {
            this.isProcessingAction = false;
        }
    },

    // --- Зміна пароля ---
    openPasswordModal() {
        this.currentPassword = ''; this.newPassword = ''; this.confirmNewPassword = '';
        this.passwordFormError = null; this.showPasswordModal = true;
         console.log('Password modal opened'); // Лог для перевірки
    },
    async submitChangePassword() {
        this.passwordFormError = null;
        const errorRequired = $store.i18n?.t('profile.errorPasswordFieldsRequired') || 'Заповніть усі поля паролів.';
        const errorInvalid = $store.i18n?.t('auth.passwordInvalid') || 'Пароль закороткий (мін. 8).';
        const errorMismatch = $store.i18n?.t('auth.passwordsDontMatch') || 'Паролі не співпадають.';
        const errorSame = $store.i18n?.t('profile.errorNewPasswordSameAsOld') || 'Новий пароль не може бути таким же.';
        const errorGeneral = $store.i18n?.t('profile.errorChangingPassword') || 'Помилка зміни пароля.';

        if (!this.currentPassword || !this.newPassword || !this.confirmNewPassword) {
            this.passwordFormError = errorRequired; return;
        }
        if (this.newPassword.length < 8) {
             this.passwordFormError = errorInvalid; return;
        }
        if (this.newPassword !== this.confirmNewPassword) {
            this.passwordFormError = errorMismatch; return;
        }
        if (this.newPassword === this.currentPassword) {
            this.passwordFormError = errorSame; return;
        }
        this.isProcessingAction = true;
        try {
             if (!this.isTesting) {
                 await api.users.changePassword(this.currentPassword, this.newPassword);
             } else {
                 await new Promise(resolve => setTimeout(resolve, 800)); // Симуляція
                 console.warn('TEST MODE: Simulating password change.');
                 if (this.currentPassword !== 'password123') { // Приклад паролю для тесту
                     throw new Error(errorGeneral);
                 }
             }
            this.showPasswordModal = false;
            this.showNotification($store.i18n?.t('notifications.passwordChanged') || 'Пароль змінено!', true);
            // Очищаємо поля після успіху
            this.currentPassword = ''; this.newPassword = ''; this.confirmNewPassword = '';
        } catch (error) {
            this.passwordFormError = error.message || errorGeneral;
            console.error('Change password error:', error);
        } finally {
            this.isProcessingAction = false;
        }
    },

    // --- Налаштування підписки ---
    openSubscriptionModal() {
        this.showSubscriptionModal = true;
         console.log('Subscription modal opened'); // Лог для перевірки
    },
    async cancelSubscription() {
        const confirmMessage = $store.i18n?.t('profile.confirmCancelSubscription') || 'Скасувати підписку?';
        if (!confirm(confirmMessage)) return;
        this.isCancellingSubscription = true;
        try {
            if (!this.isTesting) {
                await api.premium.cancel();
            } else {
                await new Promise(resolve => setTimeout(resolve, 700)); // Симуляція
                console.warn('TEST MODE: Simulating subscription cancellation.');
            }
            this.userSubscription = null; // Оновлюємо локальний стан
            this.isPremiumUser = false;   // Оновлюємо статус
            if (!this.isTesting) api.utils.setPremiumStatus(false);
            else if(this.user) this.user.isPremium = false; // Змінюємо мок дані
            this.showSubscriptionModal = false;
            this.showNotification($store.i18n?.t('notifications.subscriptionCancelled') || 'Підписку скасовано.', true);
        } catch (error) {
             this.showNotification(($store.i18n?.t('notifications.errorCancelSubscription') || 'Помилка скасування') + ': ' + error.message, false);
             console.error('Cancel subscription error:', error);
        } finally {
             this.isCancellingSubscription = false;
        }
    },

    // --- Ініціалізація ---
    async initializeProfile() {
        // Чекаємо, доки window.api стане доступним
        let attempts = 0;
        const maxAttempts = 50;
        while (typeof window.api === 'undefined' && attempts < maxAttempts) {
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
        }

        if (typeof window.api === 'undefined' && !this.isTesting) { // Перевірка isTesting
            console.error('API object failed to load within the timeout.');
            this.profileError = 'Помилка завантаження необхідних ресурсів. Спробуйте оновити сторінку.';
            this.isLoadingProfile = false;
            return;
        }

        try {
            let authenticated = false;
            // Перевіряємо реальну аутентифікацію тільки якщо не в тестовому режимі
            if (!this.isTesting) {
                authenticated = api.utils.isAuthenticated();
            }

            // Логіка для тестового режиму або реальної автентифікації
            if (this.isTesting || authenticated) {
                this.isLoggedIn = true; // Встановлюємо стан логіну

                if (this.isTesting) {
                    console.warn('TEST MODE ACTIVE: Using mock user data.');
                    this.user = JSON.parse(JSON.stringify(this.mockUser)); // Використовуємо копію мок даних
                    this.userId = this.user._id;
                    this.isPremiumUser = this.user.isPremium;
                    this.userSubscription = JSON.parse(JSON.stringify(this.mockSubscription)); // Копія мок даних підписки

                    // Заповнюємо поля для редагування з мок даних
                    this.editName = this.user.name || '';
                    this.editBio = this.user.bio || '';
                    this.editAvatarPreview = this.user.avatarUrl || null;

                    await this.waitForI18n(); // Чекаємо i18n
                    this.loadActivityData(this.activeTab); // Завантажуємо активність (теж з моками)
                    this.isLoadingProfile = false; // Завершуємо завантаження профілю
                } else {
                    console.log('User authenticated, loading profile data from API.');
                    await this.waitForI18n();
                    await this.loadProfileData(); // Завантажуємо реальні дані
                }
            } else {
                console.log('User not authenticated, redirecting to login.');
                window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname + window.location.search);
            }
        } catch (error) {
            console.error('Error during profile initialization:', error);
            this.profileError = 'Помилка ініціалізації профілю. Спробуйте оновити сторінку.';
            this.isLoadingProfile = false;
        }
    },

    // Допоміжна функція для очікування ініціалізації i18n
    async waitForI18n() {
        let attempts = 0;
        const maxAttempts = 30; // ~3 секунди
        while ((typeof $store === 'undefined' || typeof $store.i18n === 'undefined' || !$store.i18n.initialized) && attempts < maxAttempts) {
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
        }
        // Перевіряємо, чи існує $store та $store.i18n перед зверненням до initialized
        if (typeof $store === 'undefined' || typeof $store.i18n === 'undefined' || !$store.i18n.initialized) {
            console.warn('i18n store did not initialize in time.');
            // Можна додати fallback логіку або показати повідомлення
        }
    }
}   " x-init="initializeProfile()">


<!-- Хедер -->
<header>
    <div class="container">
        <nav class="navbar">
            <a href="index.html" class="logo">Таємний<span>Світ</span></a>
            <!-- Навігація з i18n -->
            <ul class="nav-links">
                <li><a href="index.html" x-text="$store.i18n.t('general.home')"></a></li>
                <li><a href="new-stories.html" x-text="$store.i18n.t('general.newStories')"></a></li>
                <li><a href="top-stories.html" x-text="$store.i18n.t('general.topStories')"></a></li>
                <li><a href="categories.html" x-text="$store.i18n.t('general.categories')"></a></li>
                <li><a href="authors.html" x-text="$store.i18n.t('general.authors')"></a></li>
            </ul>
            <div class="auth-buttons">
                <!-- Мовний перемикач -->
                <div class="lang-dropdown-container" x-data="{ open: false }" @click.away="open = false">
                    <div class="lang-dropdown-button" @click="open = !open">
                        <span x-text="$store.i18n.selectedLang.toUpperCase()"></span>
                        <i class="fas fa-chevron-down" :class="{ 'rotate-180': open }"></i>
                    </div>
                    <div class="lang-dropdown-menu" x-show="open" x-transition>
                        <template x-for="lang in $store.i18n.available" :key="lang.code">
                            <div class="lang-dropdown-item"
                                 :class="{ 'active': lang.code === $store.i18n.selectedLang }"
                                 @click="$store.i18n.setLanguage(lang.code); open = false;">
                                <span x-text="lang.name"></span>
                                <i x-show="lang.code === $store.i18n.selectedLang" class="fas fa-check"></i>
                            </div>
                        </template>
                    </div>
                </div>
                <!-- Кнопки авторизації (вже авторизований) -->
                <template x-if="isLoggedIn">
                    <div>
                        <!-- <a href="profile.html" class="btn btn-outline"><i class="fas fa-user"></i> <span x-text="$store.i18n.t('general.profile')"></span></a> -->
                        <a href="#" @click.prevent="api.auth.logout(); isLoggedIn = false; window.location.href='index.html';" class="btn btn-primary">
                            <i class="fas fa-sign-out-alt"></i> <span x-text="$store.i18n.t('general.logout')"></span>
                        </a>
                    </div>
                </template>
            </div>
        </nav>
    </div>
</header>

<!-- Основний контент -->
<main class="container">
    <!-- Хлібні крихти -->
    <div class="breadcrumbs">
        <a href="index.html" x-text="$store.i18n.t('general.home')"></a>
        <span class="separator">/</span>
        <span class="current" x-text="$store.i18n.t('general.profile')"></span>
    </div>

    <!-- Індикатор завантаження / Помилка -->
    <div x-show="isLoadingProfile" class="loading-indicator" x-text="$store.i18n.t('profile.loadingProfile')"></div>
    <div x-show="profileError" class="error-message">
        <i class="fas fa-exclamation-circle"></i> <span x-text="profileError"></span>
        <button @click="loadProfileData()" class="btn btn-outline" x-text="$store.i18n.t('general.retryButton')"></button>
    </div>

    <!-- Основний контент профілю -->
    <template x-if="user && !isLoadingProfile && !profileError">
        <div class="profile-container">
            <!-- Ліва колонка: Інформація -->
            <aside class="profile-sidebar">
                <div class="profile-header">
                    <div class="profile-avatar" :style="`background-image: url('${user.avatarUrl || 'https://source.unsplash.com/random/200x200/?profile,user'}')`">
                        <!-- Преміум-бейджик -->
                        <template x-if="user.isPremium">
                            <div class="premium-badge-profile" title="Premium акаунт">
                                <i class="fas fa-crown"></i>
                            </div>
                        </template>
                    </div>
                    <h1 class="profile-name" x-text="user.name"></h1>
                    <div class="profile-email" x-text="user.email"></div>
                </div>

                <div class="profile-bio">
                    <p x-show="user.bio" x-text="user.bio"></p>
                    <p x-show="!user.bio" class="profile-bio-placeholder" x-text="$store.i18n.t('profile.addInfoPlaceholder')"></p>
                </div>

                <div class="profile-stats">
                    <div class="profile-stat">
                        <span class="stat-value" x-text="user.stats?.storiesWritten || 0"></span>
                        <span class="stat-label" x-text="$store.i18n.t('profile.storiesWrittenShort')"></span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-value" x-text="user.stats?.commentsMade || 0"></span>
                        <span class="stat-label" x-text="$store.i18n.t('profile.commentsCount')"></span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-value" x-text="user.stats?.followersCount || 0"></span>
                        <span class="stat-label" x-text="$store.i18n.t('profile.followersShort')"></span>
                    </div>
                </div>

                <div class="profile-actions">
                    <button @click="openEditModal()" class="btn btn-outline">
                        <i class="fas fa-edit"></i> <span x-text="$store.i18n.t('profile.editProfile')"></span>
                    </button>
                    <button @click="openPasswordModal()" class="btn btn-outline">
                        <i class="fas fa-key"></i> <span x-text="$store.i18n.t('profile.changePassword')"></span>
                    </button>
                    <button @click="openSubscriptionModal()" class="btn btn-outline">
                        <i class="fas fa-crown"></i> <span x-text="$store.i18n.t('profile.subscriptionSettings')"></span>
                    </button>
                    <!-- Кнопка для авторів, щоб перейти до створення історії -->
                    <a href="create_story.html" class="btn btn-primary">
                        <i class="fas fa-plus"></i> <span x-text="$store.i18n.t('createStory.title')"></span>
                    </a>
                </div>
            </aside>

            <!-- Права колонка: Активність -->
            <section class="profile-activity">
                <div class="activity-tabs">
                    <div class="activity-tab" :class="{'active': activeTab === 'saved'}" @click="changeTab('saved')" x-text="$store.i18n.t('profile.tabSaved')"></div>
                    <div class="activity-tab" :class="{'active': activeTab === 'history'}" @click="changeTab('history')" x-text="$store.i18n.t('profile.tabHistory')"></div>
                    <div class="activity-tab" :class="{'active': activeTab === 'likes'}" @click="changeTab('likes')" x-text="$store.i18n.t('profile.tabLikes')"></div>
                    <div class="activity-tab" :class="{'active': activeTab === 'comments'}" @click="changeTab('comments')" x-text="$store.i18n.t('profile.tabComments')"></div>
                    <div class="activity-tab" :class="{'active': activeTab === 'following'}" @click="changeTab('following')" x-text="$store.i18n.t('profile.tabFollowing')"></div>
                </div>

                <div class="activity-content">
                    <!-- Індикатор завантаження / Помилка для вкладок -->
                    <div x-show="isLoadingActivity" class="loading-indicator" x-text="$store.i18n.t('profile.loadingActivity')"></div>
                    <div x-show="activityError" class="error-message">
                        <i class="fas fa-exclamation-circle"></i> <span x-text="activityError"></span>
                        <button @click="loadActivityData(activeTab)" class="btn btn-outline" x-text="$store.i18n.t('general.retryButton')"></button>
                    </div>

                    <!-- Вкладка "Збережені" -->
                    <div x-show="activeTab === 'saved' && !isLoadingActivity && !activityError" class="activity-list">
                        <template x-if="savedStories.length > 0">
                            <template x-for="item in savedStories" :key="item.story._id">
                                <div class="activity-story-card">
                                    <div class="story-info">
                                        <h4 class="story-title"><a :href="`story-detailed.html?id=${item.story._id}`" x-text="item.story.title"></a></h4>
                                        <div class="story-meta-small">
                                            <span x-text="item.story.category?.name || $store.i18n.t('general.defaultCategory')"></span> |
                                            <span x-text="item.story.author?.name || $store.i18n.t('general.anonymous')"></span>
                                        </div>
                                        <div class="story-date" x-text="`${$store.i18n.t('profile.savedOn')}: ${new Date(item.savedAt).toLocaleDateString($store.i18n.selectedLang || 'uk-UA')}`"></div>
                                    </div>
                                    <div class="story-actions-small">
                                        <button @click="removeFromSaved(item.story._id)" class="btn-small-icon" :title="$store.i18n.t('profile.removeFromSavedAction')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                        <a :href="`story-detailed.html?id=${item.story._id}`" class="btn-small-icon" :title="$store.i18n.t('general.readMore')">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            </template>
                            <!-- Пагінація для збережених -->
                            <!-- <div class="pagination" x-show="savedTotalPages > 1"> ... </div> -->
                        </template>
                        <template x-if="savedStories.length === 0">
                            <div class="empty-tab-message" x-text="$store.i18n.t('profile.noSavedStories')"></div>
                        </template>
                    </div>

                    <!-- Вкладка "Історія" (поки заглушка) -->
                    <div x-show="activeTab === 'history' && !isLoadingActivity && !activityError">
                        <div class="empty-tab-message" x-text="$store.i18n.t('profile.noHistory')"></div>
                        <!-- <template x-for="item in readingHistory" :key="item.story._id"> ... </template> -->
                    </div>

                    <!-- Вкладка "Вподобані" (поки заглушка) -->
                    <div x-show="activeTab === 'likes' && !isLoadingActivity && !activityError">
                        <div class="empty-tab-message" x-text="$store.i18n.t('profile.noLikedStories')"></div>
                        <!-- <template x-for="item in likedStories" :key="item.story._id"> ... </template> -->
                    </div>

                    <!-- Вкладка "Коментарі" (поки заглушка) -->
                    <div x-show="activeTab === 'comments' && !isLoadingActivity && !activityError" class="activity-list">
                        <template x-if="myComments.length > 0">
                            <template x-for="comment in myComments" :key="comment._id">
                                <div class="activity-comment-card">
                                    <p class="comment-text-preview" x-text="comment.text"></p>
                                    <div class="comment-meta-info">
                                        <span x-text="$store.i18n.t('profile.commentToStory')"></span>:
                                        <a :href="`story-detailed.html?id=${comment.story._id}`" x-text="comment.story.title"></a>
                                        <span> | </span>
                                        <span x-text="new Date(comment.createdAt).toLocaleString($store.i18n.selectedLang || 'uk-UA', {dateStyle: 'short', timeStyle: 'short'})"></span>
                                    </div>
                                </div>
                            </template>
                        </template>
                        <template x-if="myComments.length === 0">
                            <div class="empty-tab-message" x-text="$store.i18n.t('profile.noComments')"></div>
                        </template>
                    </div>

                    <!-- Вкладка "Підписки" -->
                    <div x-show="activeTab === 'following' && !isLoadingActivity && !activityError" class="activity-list">
                        <template x-if="following.length > 0">
                            <template x-for="author in following" :key="author._id">
                                <div class="activity-author-card">
                                    <a :href="`author-profile.html?id=${author._id}`">
                                        <div class="author-avatar" :style="`background-image: url('${author.avatarUrl || 'https://source.unsplash.com/random/100x100/?profile'}')`"></div>
                                    </a>
                                    <div class="author-info">
                                        <h4 class="author-name"><a :href="`author-profile.html?id=${author._id}`" x-text="author.name"></a></h4>
                                        <!-- Можна додати статистику автора, якщо є в API -->
                                    </div>
                                    <button @click="unfollowAuthor(author._id)" class="btn btn-outline btn-follow-small">
                                        <span x-text="$store.i18n.t('profile.unfollowAction')"></span>
                                    </button>
                                </div>
                            </template>
                        </template>
                        <template x-if="following.length === 0">
                            <div class="empty-tab-message" x-text="$store.i18n.t('profile.noFollowing')"></div>
                        </template>
                    </div>
                </div>
            </section>
        </div>
    </template>

    <!-- Модальне вікно: Редагування профілю -->
    <div class="modal-overlay" :class="{'active': showEditModal}" x-show="showEditModal" @click.self="showEditModal = false">
        <div class="modal-content" @click.stop>
            <div class="modal-header">
                <h2 class="modal-title" x-text="$store.i18n.t('profile.editFormTitle')"></h2>
                <button @click="showEditModal = false" class="modal-close-btn">×</button>
            </div>
            <div class="modal-body">
                <div x-show="editFormError" class="error-message" style="margin-bottom: 1rem;">
                    <i class="fas fa-exclamation-circle"></i> <span x-text="editFormError"></span>
                </div>
                <form @submit.prevent="submitEditProfile()">
                    <div class="form-group">
                        <label for="editName" class="form-label" x-text="$store.i18n.t('profile.editNameLabel')"></label>
                        <input type="text" id="editName" class="form-input" x-model="editName" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail" class="form-label" x-text="$store.i18n.t('profile.editEmailLabel')"></label>
                        <input type="email" id="editEmail" class="form-input" :value="user?.email" disabled :title="$store.i18n.t('profile.emailNotEditable')">
                    </div>
                    <div class="form-group">
                        <label for="editBio" class="form-label" x-text="$store.i18n.t('profile.editBioLabel')"></label>
                        <textarea id="editBio" class="form-textarea" x-model="editBio" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" x-text="$store.i18n.t('profile.editAvatarLabel')"></label>
                        <div class="avatar-edit-container">
                            <div class="avatar-preview" :style="`background-image: url('${editAvatarPreview || 'https://source.unsplash.com/random/100x100/?profile,placeholder'}')`"></div>
                            <div class="avatar-upload-options">
                                <input type="file" id="avatarFile" @change="handleAvatarChange($event)" accept="image/*" style="display: none;">
                                <label for="avatarFile" class="btn btn-outline">
                                    <i class="fas fa-upload"></i> <span x-text="$store.i18n.t('profile.chooseFileButton')"></span>
                                </label>
                                <button type="button" @click="editAvatarFile = null; editAvatarPreview = null;" class="btn btn-outline" x-show="editAvatarPreview || editAvatarFile">
                                    <i class="fas fa-times"></i> <span x-text="$store.i18n.t('profile.cancelAvatarButton')"></span>
                                </button>
                                <div class="form-help" x-text="$store.i18n.t('profile.editAvatarHelp')"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" @click="showEditModal = false" class="btn btn-outline" x-text="$store.i18n.t('general.cancel')"></button>
                        <button type="submit" class="btn btn-primary" :class="{'processing': isProcessingAction}" :disabled="isProcessingAction">
                            <span x-show="!isProcessingAction" x-text="$store.i18n.t('profile.saveChangesButton')"></span>
                            <span x-show="isProcessingAction"><span x-text="$store.i18n.t('general.saving')"></span></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальне вікно: Зміна пароля -->
    <div class="modal-overlay" :class="{'active': showPasswordModal}" x-show="showPasswordModal" @click.self="showPasswordModal = false">
        <div class="modal-content" @click.stop>
            <div class="modal-header">
                <h2 class="modal-title" x-text="$store.i18n.t('profile.changePasswordFormTitle')"></h2>
                <button @click="showPasswordModal = false" class="modal-close-btn">×</button>
            </div>
            <div class="modal-body">
                <div x-show="passwordFormError" class="error-message" style="margin-bottom: 1rem;">
                    <i class="fas fa-exclamation-circle"></i> <span x-text="passwordFormError"></span>
                </div>
                <form @submit.prevent="submitChangePassword()">
                    <div class="form-group">
                        <label for="currentPassword" class="form-label" x-text="$store.i18n.t('profile.currentPasswordLabel')"></label>
                        <input type="password" id="currentPassword" class="form-input" x-model="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="form-label" x-text="$store.i18n.t('profile.newPasswordLabel')"></label>
                        <input type="password" id="newPassword" class="form-input" x-model="newPassword" required minlength="8">
                        <div class="form-help" x-text="$store.i18n.t('profile.passwordMinHelp')"></div>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword" class="form-label" x-text="$store.i18n.t('profile.confirmNewPasswordLabel')"></label>
                        <input type="password" id="confirmNewPassword" class="form-input" x-model="confirmNewPassword" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" @click="showPasswordModal = false" class="btn btn-outline" x-text="$store.i18n.t('general.cancel')"></button>
                        <button type="submit" class="btn btn-primary" :class="{'processing': isProcessingAction}" :disabled="isProcessingAction">
                            <span x-show="!isProcessingAction" x-text="$store.i18n.t('profile.changePasswordButton')"></span>
                            <span x-show="isProcessingAction"><span x-text="$store.i18n.t('general.changing')"></span></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальне вікно: Налаштування підписки -->
    <div class="modal-overlay" :class="{'active': showSubscriptionModal}" x-show="showSubscriptionModal" @click.self="showSubscriptionModal = false">
        <div class="modal-content" @click.stop>
            <div class="modal-header">
                <h2 class="modal-title" x-text="$store.i18n.t('profile.subscriptionSettingsTitle')"></h2>
                <button @click="showSubscriptionModal = false" class="modal-close-btn">×</button>
            </div>
            <div class="modal-body">
                <template x-if="userSubscription">
                    <div class="confirmation-details" style="background: none; padding: 0; margin-bottom: 1.5rem;">
                        <div class="confirmation-detail">
                            <span class="detail-label" x-text="$store.i18n.t('premium.confirmationPlanLabel')"></span>
                            <span class="detail-value" x-text="userSubscription.planName"></span>
                        </div>
                        <div class="confirmation-detail">
                            <span class="detail-label" x-text="$store.i18n.t('premium.confirmationStatusLabel')"></span>
                            <span class="detail-value success" x-text="$store.i18n.t('premium.statusActive')"></span>
                        </div>
                        <div class="confirmation-detail">
                            <span class="detail-label" x-text="$store.i18n.t('profile.activeUntil')"></span>
                            <span class="detail-value" x-text="userSubscription.endDate ? new Date(userSubscription.endDate).toLocaleDateString($store.i18n.selectedLang || 'uk-UA') : $store.i18n.t('profile.notSpecified')"></span>
                        </div>
                        <div class="confirmation-detail">
                            <span class="detail-label" x-text="$store.i18n.t('profile.paymentMethod')"></span>
                            <span class="detail-value" x-text="userSubscription.paymentMethodLast4 ? `**** ${userSubscription.paymentMethodLast4}` : $store.i18n.t('general.paymentMethodNotSet')"></span>
                        </div>
                    </div>
                    <p style="color: var(--secondary-text); font-size: 0.9rem; margin-bottom: 1.5rem;" x-text="$store.i18n.t('profile.subscriptionWillRenew')"></p>
                    <div class="modal-footer" style="justify-content: space-between;">
                        <a href="premium.html" class="btn btn-outline" x-text="$store.i18n.t('profile.changePlanButton')"></a>
                        <button type="button" @click="cancelSubscription()" class="btn btn-danger" :class="{'processing': isCancellingSubscription}" :disabled="isCancellingSubscription">
                            <span x-show="!isCancellingSubscription" x-text="$store.i18n.t('profile.cancelSubscriptionButton')"></span>
                            <span x-show="isCancellingSubscription"><span x-text="$store.i18n.t('general.cancelling')"></span></span>
                        </button>
                    </div>
                </template>
                <template x-if="!userSubscription && isPremiumUser"> <!-- Стан, коли преміум є, але дані підписки ще завантажуються або не вдалося -->
                    <div class="loading-indicator" x-text="$store.i18n.t('general.loadingData')"></div>
                </template>
                <template x-if="!userSubscription && !isPremiumUser">
                    <p style="margin-bottom: 1.5rem;" x-text="$store.i18n.t('profile.noActiveSubscription')"></p>
                    <div class="modal-footer" style="justify-content: center;">
                        <a href="premium.html" class="btn btn-primary" x-text="$store.i18n.t('profile.getPremium')"></a>
                    </div>
                </template>
            </div>
        </div>
    </div>

</main>

<!-- Footer -->
<footer>
    <div class="container">
        <!-- Код футера з i18n, як в index.html -->
        <div class="footer-content">
            <div class="footer-section footer-about">
                <h4 x-text="$store.i18n.t('general.about')"></h4>
                <p x-text="$store.i18n.t('general.aboutText')"></p>
                <div class="social-links">
                    <a href="#" class="social-link" :title="$store.i18n.t('general.shareFacebook')"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-link" :title="$store.i18n.t('general.shareTelegram')"><i class="fab fa-telegram-plane"></i></a>
                    <a href="#" class="social-link" title="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h4 x-text="$store.i18n.t('general.navigation')"></h4>
                <ul>
                    <li><a href="index.html" x-text="$store.i18n.t('general.home')"></a></li>
                    <li><a href="categories.html" x-text="$store.i18n.t('general.categories')"></a></li>
                    <li><a href="new-stories.html" x-text="$store.i18n.t('general.newStories')"></a></li>
                    <li><a href="top-stories.html" x-text="$store.i18n.t('general.topStories')"></a></li>
                    <li><a href="authors.html" x-text="$store.i18n.t('general.authors')"></a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 x-text="$store.i18n.t('general.support')"></h4>
                <ul>
                    <li><a href="faq.html" x-text="$store.i18n.t('faq.title')"></a></li>
                    <li><a href="contact.html" x-text="$store.i18n.t('contact.title')"></a></li>
                    <li><a href="terms-page.html" x-text="$store.i18n.t('general.terms')"></a></li>
                    <li><a href="privacy-policy.html" x-text="$store.i18n.t('general.privacy')"></a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 x-text="$store.i18n.t('general.join')"></h4>
                <ul>
                    <li><a href="login.html" x-text="$store.i18n.t('general.login')"></a></li>
                    <li><a href="login.html?tab=register" x-text="$store.i18n.t('general.register')"></a></li>
                    <li><a href="premium.html" x-text="$store.i18n.t('general.premium')"></a></li>
                    <li><a href="create_story.html" x-text="$store.i18n.t('createStory.title')"></a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            © <span x-text="new Date().getFullYear()"></span> <span x-text="$store.i18n.t('general.copyright')"></span>. <span x-text="$store.i18n.t('general.allRightsReserved')"></span>. 18+ <br>
            <a href="terms-page.html" x-text="$store.i18n.t('general.terms')"></a> | <a href="privacy-policy.html" x-text="$store.i18n.t('general.privacy')"></a>
        </div>
    </div>
</footer>

<!-- Елемент сповіщення -->
<div x-show="notificationVisible"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 translate-y-2"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-300"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 -translate-y-full"
     class="notification"
     :class="{ 'show': notificationVisible, 'success': notificationType === 'success', 'error': notificationType === 'error' }"
     style="display: none;"
     id="global-notification">
    <span x-text="notificationMessage"></span>
</div>

</body>
</html>