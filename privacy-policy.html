<!DOCTYPE html>
<!-- Додано x-data та :lang -->
<html lang="uk" x-data :lang="$store.i18n.selectedLang">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Title використовує i18n -->
  <title x-text="`${$store.i18n.t('policyPages.privacyTitle')} — ${$store.i18n.t('general.copyright')}`"></title>

  <!-- Мета-теги використовують i18n -->
  <meta name="description" :content="$store.i18n.t('policyPages.privacyMetaDescription') || 'Політика конфіденційності сайту Таємний Світ. Дізнайтеся, як ми збираємо, використовуємо та захищаємо ваші персональні дані.'">
  <meta property="og:title" :content="`${$store.i18n.t('policyPages.privacyTitle')} — ${$store.i18n.t('general.copyright')}`">
  <meta property="og:description" :content="$store.i18n.t('policyPages.privacyMetaDescription') || 'Політика конфіденційності сайту Таємний Світ.'">
  <meta property="og:type" content="website">

  <!-- Стилі (використовуємо стилі від terms-page.html) -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/terms-page.css"> <!-- Використовуємо ті ж стилі -->

  <!-- API Config & Utils -->
  <script src="js/api-config.js" defer></script>
  <script src="js/api-utils.js" defer></script>

  <!-- Internationalization -->
  <script type="module" src="js/i18n.js" defer></script> <!-- Важливо: type="module" -->

  <!-- Шрифти -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

  <!-- Alpine.js -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>
    /* Стиль для кнопки прокрутки нагору */
    .scroll-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--accent);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .scroll-to-top.visible {
      opacity: 0.8;
      visibility: visible;
    }
    
    .scroll-to-top:hover {
      opacity: 1;
      background-color: var(--accent-hover);
    }
    
    /* Покращення доступності для навігації */
    .terms-navigation a:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    /* Покращення стилю посилань в розділах */
    .section a {
      color: var(--accent);
      text-decoration: underline;
    }
    
    .section a:hover {
      color: var(--accent-hover);
    }
  </style>
</head>
<!-- Простий x-data для хедера -->
<body x-data="{ 
  isLoggedIn: false,
  isPremiumUser: false,
  
  // Функція для безпечного доступу до i18n ключів
  safeT(key, fallback) {
    try {
      const translation = $store.i18n?.t(key);
      return (translation && translation !== key) ? translation : fallback;
    } catch (e) {
      console.warn(`Translation key error: ${key}`, e);
      return fallback;
    }
  },
  
  // Функція для плавного скролу до секцій
  scrollToSection(id) {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
}" x-init="
  try {
    isLoggedIn = api.utils.isAuthenticated();
    isPremiumUser = api.utils.isPremium();
  } catch (error) {
    console.error('Error checking authentication status:', error);
    isLoggedIn = false;
    isPremiumUser = false;
  }
">

<!-- Хедер -->
<header>
  <div class="container">
    <nav class="navbar">
      <a href="index.html" class="logo">Таємний<span>Світ</span></a>
      <!-- Навігація з i18n -->
      <ul class="nav-links">
        <li><a href="index.html" x-text="$store.i18n.t('general.home')"></a></li>
        <li><a href="new-stories.html" x-text="$store.i18n.t('general.newStories')"></a></li>
        <li><a href="top-stories.html" x-text="$store.i18n.t('general.topStories')"></a></li>
        <li><a href="categories.html" x-text="$store.i18n.t('general.categories')"></a></li>
        <li><a href="authors.html" x-text="$store.i18n.t('general.authors')"></a></li>
      </ul>
      <div class="auth-buttons">
        <!-- Мовний перемикач -->
        <div class="lang-dropdown-container" x-data="{ open: false }" @click.away="open = false">
          <div class="lang-dropdown-button" @click="open = !open">
            <span x-text="$store.i18n?.selectedLang?.toUpperCase() || 'UK'"></span>
            <i class="fas fa-chevron-down" :class="{ 'rotate-180': open }"></i>
          </div>
          <div class="lang-dropdown-menu" x-show="open" x-transition>
            <template x-for="lang in $store.i18n?.available || []" :key="lang.code">
              <div class="lang-dropdown-item"
                   :class="{ 'active': lang.code === $store.i18n?.selectedLang }"
                   @click="try { $store.i18n.setLanguage(lang.code); open = false; } catch(e) { console.error('Error switching language:', e); open = false; }">
                <span x-text="lang.name"></span>
                <i x-show="lang.code === $store.i18n?.selectedLang" class="fas fa-check"></i>
              </div>
            </template>
          </div>
        </div>
        <!-- Кнопки авторизації -->
        <template x-if="!isLoggedIn">
          <div>
            <a href="login.html" class="btn btn-outline"> <i class="fas fa-sign-in-alt"></i> <span x-text="$store.i18n.t('general.login')"></span> </a>
            <a href="login.html?tab=register" class="btn btn-primary"> <i class="fas fa-user-plus"></i> <span x-text="$store.i18n.t('general.register')"></span> </a>
          </div>
        </template>
        <template x-if="isLoggedIn">
          <div>
            <a href="profile.html" class="btn btn-outline"> <i class="fas fa-user"></i> <span x-text="$store.i18n.t('general.profile')"></span> </a>
            <!-- Безпечний обробник виходу з профілю -->
            <a href="#" @click.prevent="
              try { 
                api.auth.logout();
                isLoggedIn = false;
                window.location.reload();
              } catch (e) { 
                console.error('Logout error:', e);
                alert($store.i18n?.t('general.logoutError') || 'Помилка при виході з системи');
              }
            " class="btn btn-primary">
              <i class="fas fa-sign-out-alt"></i> <span x-text="$store.i18n.t('general.logout')"></span>
            </a>
          </div>
        </template>
      </div>
    </nav>
  </div>
</header>

<!-- Основний контент -->
<main>
  <div class="container">
    <!-- Хлібні крихти -->
    <div class="breadcrumbs">
      <a href="index.html" x-text="$store.i18n.t('general.home')"></a>
      <span class="separator">/</span>
      <span class="current" x-text="$store.i18n.t('policyPages.privacyTitle')"></span>
    </div>

    <div class="terms-container" role="main"> <!-- Використовуємо той самий контейнер, що й для terms-page -->rms-page -->
      <!-- Заголовок -->
      <div class="terms-header">
        <!-- Приклад використання безпечної функції перекладу -->
        <h1 class="terms-title" x-text="safeT('policyPages.privacyTitle', 'Політика конфіденційності')" id="privacy-top"></h1>rivacy-top"></h1>
        <p class="terms-description" x-text="safeT('policyPages.privacyDescription', 'Як ми збираємо, використовуємо та захищаємо ваші персональні дані')"></p>
        <!-- Дата оновлення -->
        <span class="last-updated" x-text="`${safeT('policyPages.lastUpdated', 'Останнє оновлення')}: 12 березня 2025 р.`" aria-label="Дата останнього оновлення політики"></span> р.`" aria-label="Дата останнього оновлення політики"></span>
      </div>

      <!-- Навігація по розділах з атрибутами доступності -->
      <nav class="terms-navigation" aria-labelledby="privacy-top">aria-labelledby="privacy-top">
        <a href="#collection" @click.prevent="scrollToSection('collection')" x-text="safeT('policyPages.privacyNavCollection', 'Збір даних')"></a>
        <a href="#usage" @click.prevent="scrollToSection('usage')" x-text="safeT('policyPages.privacyNavUsage', 'Використання даних')"></a>
        <a href="#protection" @click.prevent="scrollToSection('protection')" x-text="safeT('policyPages.privacyNavProtection', 'Захист даних')"></a>
        <a href="#cookies" @click.prevent="scrollToSection('cookies')" x-text="safeT('policyPages.privacyNavCookies', 'Файли cookie')"></a>
        <a href="#rights" @click.prevent="scrollToSection('rights')" x-text="safeT('policyPages.privacyNavRights', 'Ваші права')"></a>
        <a href="#changes" @click.prevent="scrollToSection('changes')" x-text="safeT('policyPages.privacyNavChanges', 'Зміни політики')"></a>
        <a href="#contact" @click.prevent="scrollToSection('contact')" x-text="safeT('policyPages.privacyNavContact', 'Контакти')"></a>
      </nav>

      <!-- Зміст політики (використовуємо ключі i18n) -->
      <div class="terms-content">
        <section id="collection" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection1Title')"></h2>
          <div class="subsection">
            <h3 class="subsection-title" x-text="$store.i18n.t('policyPages.privacySection1_1Title')"></h3>
            <p x-text="$store.i18n.t('policyPages.privacySection1_1Intro')"></p>
            <ul>
              <li x-text="$store.i18n.t('policyPages.privacyCollectionPoint1')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyCollectionPoint2')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyCollectionPoint3')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyCollectionPoint4')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyCollectionPoint5')"></li>
            </ul>
          </div>
          <div class="subsection">
            <h3 class="subsection-title" x-text="$store.i18n.t('policyPages.privacySection1_2Title')"></h3>
            <p x-text="$store.i18n.t('policyPages.privacySection1_2Intro')"></p>
            <ul>
              <li x-text="$store.i18n.t('policyPages.privacyAutoCollectionPoint1')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyAutoCollectionPoint2')"></li>
              <li x-text="$store.i18n.t('policyPages.privacyAutoCollectionPoint3')"></li>
            </ul>
          </div>
        </section>

        <section id="usage" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection2Title')"></h2>
          <p x-text="$store.i18n.t('policyPages.privacySection2Intro')"></p>
          <ul>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint1')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint2')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint3')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint4')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint5')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint6')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint7')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyUsagePoint8')"></li>
          </ul>
        </section>

        <section id="protection" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection3Title')"></h2>
          <p x-text="$store.i18n.t('policyPages.privacySection3Text')"></p>
          <!-- Можна додати підрозділи, якщо політика детальніша -->
        </section>

        <section id="cookies" class="section" aria-labelledby="cookies-heading">
          <h2 class="section-title" id="cookies-heading" x-text="safeT('policyPages.privacySection4Title', 'Файли cookie та технології відстеження')"></h2>
          <p x-text="safeT('policyPages.privacySection4Text1', 'Ми використовуємо файли cookie та подібні технології для покращення вашого досвіду на нашому веб-сайті.')"></p>
          <p x-text="safeT('policyPages.privacySection4Text2', 'Наш веб-сайт використовує такі типи файлів cookie:')"></p>
          <ul>
            <li x-text="safeT('policyPages.privacyCookieType1', 'Необхідні файли cookie: потрібні для функціонування веб-сайту')"></li>
            <li x-text="safeT('policyPages.privacyCookieType2', 'Аналітичні файли cookie: допомагають нам розуміти, як відвідувачі взаємодіють з веб-сайтом')"></li>
            <li x-text="safeT('policyPages.privacyCookieType3', 'Функціональні файли cookie: дозволяють веб-сайту запам\'ятати ваші налаштування')"></li>
            <li x-text="safeT('policyPages.privacyCookieType4', 'Рекламні файли cookie: допомагають показувати вам релевантну рекламу')"></li>
          </ul>
          <p x-text="safeT('policyPages.privacyCookieManage', 'Ви можете керувати файлами cookie через налаштування вашого браузера.')"></p>
        </section>

        <section id="rights" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection5Title')"></h2>
          <p x-text="$store.i18n.t('policyPages.privacySection5Intro')"></p>
          <ul>
            <li x-text="$store.i18n.t('policyPages.privacyRightAccess')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyRightCorrection')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyRightDeletion')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyRightRestriction')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyRightObjection')"></li>
            <li x-text="$store.i18n.t('policyPages.privacyRightPortability')"></li>
          </ul>
          <p x-text="$store.i18n.t('policyPages.privacyRightsContact')"></p>
        </section>

        <section id="changes" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection6Title')"></h2>
          <p x-text="$store.i18n.t('policyPages.privacySection6Text')"></p>
        </section>

        <section id="contact" class="section">
          <h2 class="section-title" x-text="$store.i18n.t('policyPages.privacySection7Title')"></h2>
          <p x-text="$store.i18n.t('policyPages.privacySection7Intro')"></p>
          <p><span x-text="$store.i18n.t('contact.formEmailLabel')"></span> <a href="mailto:admin@e.world">admin@e.world</a></p>
          <p><span x-text="$store.i18n.t('contact.formTitle')"></span>: <a href="contact.html" x-text="$store.i18n.t('faq.contactUsButton')"></a></p>
        </section>
      </div>

      <!-- Додаємо можливість PDF експорту -->
      <div class="terms-actions">
        <button @click="generatePDF()" class="btn btn-outline" title="Завантажити політику конфіденційності у форматі PDF">
          <i class="fas fa-file-pdf"></i> <span x-text="safeT('policyPages.downloadPDF', 'Завантажити PDF')"></span>
        </button>
      </div>

      <!-- Футер сторінки -->
      <div class="terms-footer">
        <p x-text="$store.i18n.t('policyPages.footerText')"></p>
        <a href="index.html" class="btn btn-outline" x-text="$store.i18n.t('policyPages.backToHomeButton')"></a>
      </div>
    </div>
  </div>
</main>

<!-- Додавання кнопки нагору для зручності -->
<button class="scroll-to-top" 
        @click="window.scrollTo({top: 0, behavior: 'smooth'})" 
        :class="{ 'visible': window.scrollY > 500 }" 
        x-data 
        x-init="window.addEventListener('scroll', () => $el.classList.toggle('visible', window.scrollY > 500))" 
        aria-label="Прокрутити нагору" 
        title="Нагору">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Footer -->
<footer>
  <div class="container">
    <!-- Код футера з i18n, як в index.html -->
    <div class="footer-content">
      <div class="footer-section footer-about">
        <h4 x-text="$store.i18n.t('general.about')"></h4>
        <p x-text="$store.i18n.t('general.aboutText')"></p>
        <div class="social-links">
          <a href="#" class="social-link" :title="$store.i18n.t('general.shareFacebook')"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="social-link" :title="$store.i18n.t('general.shareTelegram')"><i class="fab fa-telegram-plane"></i></a>
          <a href="#" class="social-link" title="Instagram"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
      <div class="footer-section">
        <h4 x-text="$store.i18n.t('general.navigation')"></h4>
        <ul>
          <li><a href="index.html" x-text="$store.i18n.t('general.home')"></a></li>
          <li><a href="categories.html" x-text="$store.i18n.t('general.categories')"></a></li>
          <li><a href="new-stories.html" x-text="$store.i18n.t('general.newStories')"></a></li>
          <li><a href="top-stories.html" x-text="$store.i18n.t('general.topStories')"></a></li>
          <li><a href="authors.html" x-text="$store.i18n.t('general.authors')"></a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4 x-text="$store.i18n.t('general.support')"></h4>
        <ul>
          <li><a href="faq.html" x-text="$store.i18n.t('faq.title')"></a></li>
          <li><a href="contact.html" x-text="$store.i18n.t('contact.title')"></a></li>
          <li><a href="terms-page.html" x-text="$store.i18n.t('general.terms')"></a></li>
          <li><a href="privacy-policy.html" x-text="$store.i18n.t('general.privacy')"></a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4 x-text="$store.i18n.t('general.join')"></h4>
        <ul>
          <li><a href="login.html" x-text="$store.i18n.t('general.login')"></a></li>
          <li><a href="login.html?tab=register" x-text="safeT('general.register', 'Реєстрація')"></a></li>
          <li><a href="premium.html" x-text="$store.i18n.t('general.premium')"></a></li>
          <li><a href="create_story.html" x-text="$store.i18n.t('createStory.title')"></a></li>
        </ul>
      </div>
    </div>
    <!-- Виправлений футер з безпечною логікою для дати -->
    <div class="footer-bottom">
      © <span x-text="new Date().getFullYear() || '2025'"></span> 
      <span x-text="safeT('general.copyright', 'Таємний Світ')"></span>. 
      <span x-text="safeT('general.allRightsReserved', 'Всі права захищені')"></span>. 18+ <br>
      <a href="terms-page.html" x-text="safeT('general.terms', 'Умови використання')"></a> | 
      <a href="privacy-policy.html" x-text="safeT('general.privacy', 'Політика конфіденційності')"></a>
    </div>
  </div>
</footer>

<!-- Обробник подій для подсвічування активних розділів при скролі -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  const sections = document.querySelectorAll('.section');
  const navLinks = document.querySelectorAll('.terms-navigation a');
  
  function highlightNavigation() {
    let scrollY = window.pageYOffset;
    
    sections.forEach(section => {
      const sectionHeight = section.offsetHeight;
      const sectionTop = section.offsetTop - 100; // Відступ для раннього підсвічування
      const sectionId = section.getAttribute('id');
      
      if(scrollY > sectionTop && scrollY <= sectionTop + sectionHeight) {
        // Знаходимо відповідне посилання і додаємо активний клас
        navLinks.forEach(link => {
          if(link.getAttribute('href') === '#' + sectionId) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        });
      }
    });
  }
  
  // Додаємо стиль для активних посилань
  const style = document.createElement('style');
  style.textContent = `
    .terms-navigation a.active {
      color: var(--accent);
      font-weight: bold;
      position: relative;
    }
    .terms-navigation a.active::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--accent);
    }
  `;
  document.head.appendChild(style);
  
  // Додаємо прослуховування скролу для підсвічування
  window.addEventListener('scroll', highlightNavigation);
  
  // Викликаємо один раз для ініціалізації
  highlightNavigation();
});

// Проста імітація завантаження PDF
function generatePDF() {
  alert('Функціональність завантаження PDF буде реалізована пізніше. Наразі ви можете використовувати функцію друку браузера (Ctrl+P/Cmd+P).');
}
</script>

</body>
</html>